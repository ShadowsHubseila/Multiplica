local Players = game:GetService("Players")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

local WorkspaceCom = workspace:WaitForChild("WorkspaceCom")
local giveTools = WorkspaceCom:WaitForChild("001_GiveTools")

local basketball = giveTools:FindFirstChild("Basketball")
local box = giveTools:FindFirstChild("Box")
local soccerBall = giveTools:FindFirstChild("SoccerBall")
local signBlack = giveTools:FindFirstChild("SignBlack")
local fireX = giveTools:FindFirstChild("FireX")
local book = giveTools:FindFirstChild("Book")
local roses = giveTools:FindFirstChild("Roses") -- NOVO

-- Função para contar ferramentas
local function getToolCount()
    local count = #player.Backpack:GetChildren()
    for _, v in ipairs(char:GetChildren()) do
        if v:IsA("Tool") then
            count += 1
        end
    end
    return count
end

-- Função genérica para coletar ferramentas
local function collectItem(item, amount)
    if not item then return end
    local originalPos = hrp.CFrame
    hrp.CFrame = item.CFrame + Vector3.new(0,5,0)

    local clickDetector = item:FindFirstChildOfClass("ClickDetector")
    local prompt = item:FindFirstChildOfClass("ProximityPrompt")

    task.spawn(function()
        while task.wait(0.2) do
            if getToolCount() >= amount then
                hrp.CFrame = originalPos
                warn("Pegou "..amount.." "..item.Name.."s!")
                break
            end

            if clickDetector then
                fireclickdetector(clickDetector)
            elseif prompt then
                fireproximityprompt(prompt)
            else
                firetouchinterest(hrp, item, 0)
                task.wait()
                firetouchinterest(hrp, item, 1)
            end
        end
    end)
end

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CollectorUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 220, 0, 280) -- aumentei para caber o Roses
mainFrame.Position = UDim2.new(0.5, -110, 0.5, -140) -- centralizado
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.BorderSizePixel = 0
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.Parent = screenGui

-- Arrastável
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)
game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Título
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,25)
title.Position = UDim2.new(0,0,0,0)
title.BackgroundColor3 = Color3.fromRGB(30,30,30)
title.BorderSizePixel = 0
title.Text = "Collector Hub"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = mainFrame

-- Botão X para fechar
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0,25,0,25)
closeButton.Position = UDim2.new(1,-25,0,0)
closeButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
closeButton.TextColor3 = Color3.fromRGB(255,255,255)
closeButton.Text = "X"
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.BorderSizePixel = 0
closeButton.Parent = mainFrame
closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- Scroll Frame
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -10, 1, -35)
scrollFrame.Position = UDim2.new(0, 5, 0, 30)
scrollFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
scrollFrame.BorderSizePixel = 0
scrollFrame.CanvasSize = UDim2.new(0,0,0,0)
scrollFrame.ScrollBarThickness = 6
scrollFrame.Parent = mainFrame

-- Layout vertical
local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0,6)
layout.FillDirection = Enum.FillDirection.Vertical
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Parent = scrollFrame

-- Função para criar linha de item
local function createLine(name, item)
    if not item then return end
    local lineFrame = Instance.new("Frame")
    lineFrame.Size = UDim2.new(1,0,0,40)
    lineFrame.BackgroundTransparency = 1
    lineFrame.Parent = scrollFrame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0,100,1,0)
    label.Position = UDim2.new(0,0,0,0)
    label.BackgroundTransparency = 1
    label.Text = name.." ="
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = lineFrame

    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(0,60,0,25)
    textBox.Position = UDim2.new(0,100,0.5,-12)
    textBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
    textBox.BorderSizePixel = 0
    textBox.PlaceholderText = "0"
    textBox.Text = ""
    textBox.TextColor3 = Color3.fromRGB(255,255,255)
    textBox.ClearTextOnFocus = false
    textBox.Parent = lineFrame

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0,60,0,25)
    button.Position = UDim2.new(0,165,0.5,-12)
    button.BackgroundColor3 = Color3.fromRGB(255,255,255)
    button.TextColor3 = Color3.fromRGB(0,0,0)
    button.Text = name
    button.Font = Enum.Font.GothamBold
    button.TextSize = 12
    button.BorderSizePixel = 0
    button.Parent = lineFrame

    button.MouseButton1Click:Connect(function()
        local amount = tonumber(textBox.Text)
        if amount and amount > 0 then
            collectItem(item, amount)
        else
            warn("Insira um número válido para "..name.."!")
        end
    end)
end

-- Criar linhas para todos os itens
createLine("Basquete", basketball)
createLine("Caixa", box)
createLine("Bola de Futebol", soccerBall)
createLine("Placa Preta", signBlack)
createLine("FireX", fireX)
createLine("Livro", book)
createLine("Rosas", roses)

-- Ajustar CanvasSize do scroll
layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y)
end)
